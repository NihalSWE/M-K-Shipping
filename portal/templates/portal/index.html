{% extends "portal/base.html" %}

{% load static %}

{% block custom_css %}
<link rel="stylesheet preload" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
{% comment %} <link rel="stylesheet" href="{% static 'assets/css/select2_custom_style.css' %}"> {% endcomment %}

<style>
    /* Container styling to match img1 */
    .form-area-v2 {
        display: flex;
        align-items: center;
        background: #fff;
        padding: 15px 25px;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        gap: 10px;
    }

    .search-input-group {
        display: flex;
        align-items: center;
        border: 1px solid #EAEAEA;
        border-radius: 12px;
        padding: 10px 15px;
        flex: 1;
        min-height: 70px;
        background: #fff;
    }

    .input-content {
        display: flex;
        flex-direction: column;
        margin-left: 10px;
        width: 100%; /* Ensures Select2 takes full width */
    }

    .label-tag {
        font-size: 11px;
        font-weight: 700;
        color: #FF8C66; /* Orange color */
        margin-bottom: 0;
        text-transform: uppercase;
    }

    .search-field {
        border: none;
        outline: none;
        font-weight: 600;
        font-size: 16px;
        color: #333;
        width: 100%;
        padding: 0;
        background: transparent;
    }

    .search-field::placeholder {
        color: #2C3E50;
        opacity: 1;
    }

    .exchange-icon {
        padding: 0 5px;
        cursor: pointer;
    }

    .search-submit-btn {
        background-color: #2ECC71;
        color: white;
        border: none;
        padding: 15px 40px;
        border-radius: 12px;
        font-weight: 700;
        font-size: 16px;
        cursor: pointer;
        transition: 0.3s;
        height: 70px;
        width: 100%;
    }

    .search-submit-btn:hover {
        background-color: #27ae60;
    }

    /* --- 2. SELECT2 CUSTOM MODERN STYLING --- */

    /* Remove default Select2 box styling to match your group look */
    .select2-container--default .select2-selection--single {
        border: none !important;
        background: transparent !important;
        height: 25px !important; /* Fixed height for alignment */
        display: flex;
        align-items: center;
    }

    /* Align Select2 text with your search-field style */
    .select2-container--default .select2-selection--single .select2-selection__rendered {
        padding-left: 0 !important;
        line-height: 25px !important;
        font-weight: 600 !important;
        font-size: 16px !important;
        color: #333 !important;
    }

    /* Hide the default small arrow for a cleaner look */
    .select2-container--default .select2-selection--single .select2-selection__arrow {
        display: none;
    }

    /* Dropdown Menu Styling */
    .select2-dropdown {
        border: 1px solid #eee !important;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1) !important;
        border-radius: 12px !important;
        overflow: hidden;
        margin-top: 5px;
        z-index: 9999;
    }

    /* Dropdown items hover/selection color */
    .select2-results__option--highlighted[aria-selected] {
        background-color: #2ECC71 !important; /* Theme Green */
    }

    .select2-container--default .select2-results__option--selectable {
        padding: 10px 15px;
    }

    /* --- 3. FLATPICKR OVERRIDES (Your Original Style) --- */
    .flatpickr-calendar {
        border-radius: 12px !important;
        box-shadow: 0 8px 30px rgba(0,0,0,0.15) !important;
        width: 320px !important;
        border: 1px solid #eee !important;
        padding: 10px 5px !important;
    }

    .flatpickr-current-month {
        padding: 10px 0 !important;
    }

    .flatpickr-current-month .flatpickr-monthDropdown-months,
    .flatpickr-current-month input.cur-year {
        color: #079D49 !important;
        font-weight: 800 !important;
        text-transform: uppercase;
        font-size: 16px !important;
    }

    .flatpickr-prev-month, .flatpickr-next-month {
        top: 15px !important;
        width: 35px !important;
        height: 35px !important;
        border-radius: 50% !important;
        display: flex !important;
        align-items: center;
        justify-content: center;
        transition: 0.3s;
    }

    .flatpickr-prev-month { background: #E0E0E0 !important; left: 15px !important; }
    .flatpickr-next-month { background: #079D49 !important; right: 15px !important; }

    .flatpickr-prev-month svg, .flatpickr-next-month svg { fill: #fff !important; width: 12px !important; }
    .flatpickr-prev-month svg { fill: #888 !important; }

    span.flatpickr-weekday { color: #2C3E50 !important; font-weight: 700 !important; }

    .flatpickr-day { color: #444; font-weight: 500; border-radius: 6px !important; }

    .flatpickr-day.selected, .flatpickr-day.selected:hover {
        background: #fff !important;
        border: 2px solid #079D49 !important;
        color: #079D49 !important;
        font-weight: 700;
        position: relative;
    }

    .flatpickr-day.selected::after {
        content: "âœ“";
        position: absolute;
        bottom: -2px;
        right: 1px;
        font-size: 8px;
        background: #079D49;
        color: white;
        width: 10px;
        height: 10px;
        border-radius: 2px;
        line-height: 10px;
    }

    .flatpickr-day:hover { background: #F0F9F4 !important; }



    /* --- 4. MOBILE RESPONSIVE (Your Original Style) --- */
    @media (max-width: 991px) {
        .form-area-v2 {
            flex-direction: column;
            padding: 20px;
        }
        .search-input-group, .button-area {
            width: 100%;
        }
        .exchange-icon {
            transform: rotate(90deg);
            margin: 5px 0;
        }
    }
 </style>
{% endblock custom_css %}


{% block content %}
    <!-- rts banner area start -->
    <div class="rts-banner-area-six overflow-hidden radius-10" 
     style="{% if banner.background_image %}background-image: url('{{ banner.background_image.url }}');{% else %}background-image: url('{% static 'portal/assets/images/banner/bg-11.webp' %}');{% endif %}">
    <div class="container">
        <div class="rts-banner-wrapper">
            <div class="row justify-content-center">
                <div class="col-xl-8 col-lg-10">
                    <div class="banner-wrapper-inner text-center">
                        
                        {% if banner.logo %}
                        <div class="banner-logo wow fadeInUp" data-wow-delay="0.2s">
                            <a href="{% url 'home' %}">
                                <img style="height:50px" src="{{ banner.logo.url }}" alt="Banner Logo">
                            </a>
                        </div>
                        {% endif %}

                        <h1 class="banner-title wow fadeInUp" data-wow-delay="0.4s">
                            {{ banner.title|default:"Gateway to Global Tours" }}
                        </h1>

                        <p class="desc wow fadeInUp" data-wow-delay="0.6s">
                            {{ banner.description|default:"Discover exclusive travel packages from trusted agents around the world."|truncatechars:107 }}
                        </p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <!-- rts banner area end -->

    <div id="advance_search" class="rts__section advance__search__section is__home__one tour-marketplace">
        <div class="container">
            <form action="{% url 'search_trips' %}" method="GET" class="form-area-v2 bg-white">
                <div class="form-area-v2 bg-white">
                    <div class="search-input-group">
                        <div class="icon-box">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L4.5 20.29L5.21 21L12 18L18.79 21L19.5 20.29L12 2Z" fill="#2ECC71"/>
                            </svg>
                        </div>
                        
                        <div class="input-content">
                            <p class="label-tag">FROM</p>
                            <select id="search-from" class="search-field select2" name="from">
                                <option value="" selected disabled>Select Origin</option>
                                {% for location in locations %}
                                    <option value="{{ location.id }}">{{ location.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="exchange-icon" id="switch-location" style="cursor: pointer;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17 17H7V14L3 18L7 22V19H18V13H17V17ZM7 7H17V10L21 6L17 2V5H6V11H7V7Z" fill="#2C3E50"/>
                        </svg>
                    </div>

                    <div class="search-input-group">
                        <div class="icon-box">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z" fill="#2ECC71"/>
                            </svg>
                        </div>
                        <div class="input-content">
                            <p class="label-tag">TO</p>
                            <select id="search-to" class="search-field select2" name="to" disabled>
                                <option value="" selected disabled>Select Destination</option>
                            </select>
                        </div>
                    </div>

                    <div class="search-input-group calendar-trigger">
                        <div class="input-content ps-3">
                            <p class="label-tag">JOURNEY DATE</p>
                            <input type="text" id="journey-date" placeholder="Pick a date" class="search-field" name="date" readonly>
                        </div>
                    </div>

                    <div class="button-area">
                        <button type="submit" class="search-submit-btn">SEARCH</button>
                    </div>
                </div>
            </div>
        </form>
    </div>

 


    


    <!-- rts Offer area start -->
    <div class="rts-offer-area rts-section-gap">
        <section id="content" class="container">
            <div class="row mb-5">
                <div class="col-md-12 text-center">
                    <h3 class="section-heading" style="color: #000; font-weight: bold; font-size: 32px;">
                        <span style="color: #079D49;">Buy launch tickets</span> in 3 easy steps
                    </h3>
                </div>
            </div>
    
            <div class="row">
                <div class="col-md-4 mb-4">
                    <div class="row align-items-center">
                        <div class="col-3 col-md-3 text-right">
                            <svg xmlns="http://www.w3.org/2000/svg" width="62" height="79" viewBox="0 0 62 79" fill="none">
                                <rect x="19" y="15" width="43" height="64" rx="12" fill="#079D49" fill-opacity="0.05"></rect>
                                <path d="M24.65 3.85742C36.25 3.85742 45.65 13.2574 45.65 24.8574C45.65 36.4574 36.25 45.8574 24.65 45.8574C13.05 45.8574 3.65002 36.4574 3.65002 24.8574C3.65002 13.2574 13.15 3.85742 24.65 3.85742ZM24.65 0.857422C11.45 0.857422 0.650024 11.5574 0.650024 24.8574C0.650024 38.1574 11.35 48.8574 24.65 48.8574C37.95 48.8574 48.65 38.1574 48.65 24.8574C48.65 11.5574 37.95 0.857422 24.65 0.857422Z" fill="#079D49"></path>
                                <path d="M52.75 61.4572C51.35 61.4572 49.95 60.9572 48.95 59.8572L35.85 46.7572C35.25 46.1572 35.25 45.2572 35.85 44.6572C36.45 44.0572 37.35 44.0572 37.95 44.6572L50.95 57.7572C51.85 58.6572 53.35 58.6572 54.25 57.8572C54.75 57.4572 55.05 56.7572 55.05 56.1572C55.05 55.4572 54.85 54.8572 54.35 54.4572L41.85 41.9572C41.25 41.3572 41.25 40.4572 41.85 39.8572C42.45 39.2572 43.35 39.2572 43.95 39.8572L56.55 52.2572C57.65 53.2572 58.15 54.6572 58.15 56.1572C58.15 57.6572 57.55 59.0572 56.45 60.0572C55.35 60.9572 54.05 61.4572 52.75 61.4572Z" fill="#079D49"></path>
                            </svg>
                        </div>
                        <div class="col-9 col-md-9">
                            <p class="step-title" style="font-weight: bold; font-size: 18px; margin: 0;">Search</p>
                            <p class="step-description" style="font-size: 14px; color: #666;">Choose your origin, destination, journey dates and search for launches</p>
                        </div>
                    </div>
                </div>
    
                <div class="col-md-4 mb-4">
                    <div class="row align-items-center">
                        <div class="col-3 col-md-3 text-right">
                            <svg xmlns="http://www.w3.org/2000/svg" width="63" height="87" viewBox="0 0 63 87" fill="none">
                                <rect x="20" y="23" width="43" height="64" rx="12" fill="#079D49" fill-opacity="0.05"></rect>
                                <path d="M41.0498 68.5578H18.1498C17.0498 68.5578 15.9498 68.0578 15.2498 67.2578C14.4498 66.3578 11.9498 62.7578 8.94983 58.5578C6.24983 54.6578 3.04983 50.3578 2.24983 49.2578C1.54983 48.3578 1.14983 47.2578 1.24983 46.0578C1.34983 44.9578 1.94983 43.8578 2.84983 43.1578C6.04983 40.5578 10.4498 40.3578 13.8498 42.6578L15.5498 43.8578V22.1578C15.5498 18.3578 18.6498 15.2578 22.4498 15.2578C26.2498 15.2578 29.3498 18.3578 29.3498 22.1578V34.3578L39.9498 38.3578C45.7498 40.5578 49.1498 46.4578 48.0498 52.5578C47.1498 57.7578 45.4498 64.0578 44.4498 66.2578C43.9498 67.6578 42.5498 68.5578 41.0498 68.5578ZM8.64983 44.1578C7.24983 44.1578 5.84983 44.6578 4.64983 45.5578C4.34983 45.7578 4.24983 46.0578 4.14983 46.4578C4.04983 46.8578 4.24983 47.1578 4.44983 47.3578C5.44983 48.4578 8.24983 52.5578 11.3498 56.8578C14.0498 60.6578 16.8498 64.5578 17.4498 65.3578C17.6498 65.5578 17.8498 65.6578 18.0498 65.6578H41.0498C41.3498 65.6578 41.6498 65.4578 41.8498 65.1578C42.6498 63.3578 44.2498 57.6578 45.1498 52.1578C45.9498 47.5578 43.3498 42.9578 38.9498 41.3578L27.3498 36.9578C26.7498 36.7578 26.3498 36.1578 26.3498 35.5578V22.2578C26.3498 20.0578 24.5498 18.3578 22.4498 18.3578C20.2498 18.3578 18.5498 20.1578 18.5498 22.2578V46.6578C18.5498 47.2578 18.2498 47.7578 17.7498 47.9578C17.2498 48.2578 16.6498 48.1578 16.2498 47.8578L12.1498 45.2578C11.0498 44.4578 9.84983 44.1578 8.64983 44.1578Z" fill="#079D49"></path>
                            </svg>
                        </div>
                        <div class="col-9 col-md-9">
                            <p class="step-title" style="font-weight: bold; font-size: 18px; margin: 0;">Select</p>
                            <p class="step-description" style="font-size: 14px; color: #666;">Select your desired trip and choose your seats</p>
                        </div>
                    </div>
                </div>
    
                <div class="col-md-4 mb-4">
                    <div class="row align-items-center">
                        <div class="col-3 col-md-3 text-right">
                            <svg xmlns="http://www.w3.org/2000/svg" width="62" height="77" viewBox="0 0 62 77" fill="none">
                                <rect x="19" y="13" width="43" height="64" rx="12" fill="#079D49" fill-opacity="0.05"></rect>
                                <path d="M27.5499 0.257812H22.6499H13.8499H8.9499C4.3499 0.257812 0.649902 3.95781 0.649902 8.55781V50.4578C0.649902 55.0578 4.3499 58.7578 8.9499 58.7578H27.4499C32.0499 58.7578 35.7499 55.0578 35.7499 50.4578V8.55781C35.9499 3.95781 32.1499 0.257812 27.5499 0.257812ZM32.9499 50.4578C32.9499 53.3578 30.5499 55.7578 27.6499 55.7578H9.0499C6.1499 55.7578 3.7499 53.3578 3.7499 50.4578V8.55781C3.7499 5.65781 6.1499 3.25781 9.0499 3.25781H12.4499V4.75781C12.4499 5.55781 13.1499 6.25781 13.9499 6.25781H22.7499C23.5499 6.25781 24.2499 5.55781 24.2499 4.75781V3.25781H27.6499C30.5499 3.25781 32.9499 5.65781 32.9499 8.55781V50.4578Z" fill="#079D49"></path>
                            </svg>
                        </div>
                        <div class="col-9 col-md-9">
                            <p class="step-title" style="font-weight: bold; font-size: 18px; margin: 0;">Pay</p>
                            <p class="step-description" style="font-size: 14px; color: #666;">Pay by bank cards or mobile banking</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- rts Offer area end -->

    <!-- rts Destination area start -->
    <section class="rts-destination-area rts-section-gapBottom">
        <div class="container">
            <div class="section-title-area center-style">
                <h2 class="section-title text-uppercase wow fadeInUp" data-wow-delay="0.4s">Top Destination</h2>
            </div>
            <div class="section-inner mt--60">
                <div class="destination-area-3">
                    <div class="destination-wrapper-3 image-transform wow scaleIn" data-wow-delay="0.2s">
                        <div class="image-area wow zoomIn">
                            <a href="destination-details.html">
                                <img class="hover-image" src="{% static 'portal/assets/images/destination/27.webp'%}" width="150" alt="">
                            </a>
                        </div>
                        <div class="content">
                            <h6 class="title f-medium"><a href="destination-details.html">New York </a></h6>
                        </div>
                    </div>
                    <div class="destination-wrapper-3 image-transform wow scaleIn" data-wow-delay="0.4s">
                        <div class="image-area wow zoomIn">
                            <a href="destination-details.html">
                                <img class="hover-image" src="{% static 'portal/assets/images/destination/28.webp'%}" width="150" alt="">
                            </a>
                        </div>
                        <div class="content">
                            <h6 class="title f-medium"><a href="destination-details.html">Maldives</a></h6>
                        </div>
                    </div>
                    <div class="destination-wrapper-3 image-transform wow scaleIn" data-wow-delay="0.6s">
                        <div class="image-area wow zoomIn">
                            <a href="destination-details.html">
                                <img class="hover-image" src="{% static 'portal/assets/images/destination/29.webp'%}" width="150" alt="">
                            </a>
                        </div>
                        <div class="content">
                            <h6 class="title f-medium"><a href="destination-details.html">Greek Islands</a></h6>
                        </div>
                    </div>
                    <div class="destination-wrapper-3 image-transform wow scaleIn" data-wow-delay="0.8s">
                        <div class="image-area wow zoomIn">
                            <a href="destination-details.html">
                                <img class="hover-image" src="{% static 'portal/assets/images/destination/30.webp'%}" width="150" alt="">
                            </a>
                        </div>
                        <div class="content">
                            <h6 class="title f-medium"><a href="destination-details.html">Dubai Coastline</a></h6>
                        </div>
                    </div>
                    <div class="destination-wrapper-3 image-transform wow scaleIn" data-wow-delay="1s">
                        <div class="image-area wow zoomIn">
                            <a href="destination-details.html">
                                <img class="hover-image" src="{% static 'portal/assets/images/destination/31.webp'%}" width="150" alt="">
                            </a>
                        </div>
                        <div class="content">
                            <h6 class="title f-medium"><a href="destination-details.html">Bali, Indonesia</a></h6>
                        </div>
                    </div>
                    <div class="destination-wrapper-3 image-transform wow scaleIn" data-wow-delay="1.2s">
                        <div class="image-area wow zoomIn">
                            <a href="destination-details.html">
                                <img class="hover-image" src="{% static 'portal/assets/images/destination/32.webp'%}" width="150" alt="">
                            </a>
                        </div>
                        <div class="content">
                            <h6 class="title f-medium"><a href="destination-details.html">Croatia</a></h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- rts Destination area end -->

{% endblock content %}

{% block custom_js %}
{% comment %} <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> {% endcomment %}
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
    $(document).ready(function () {
        $('.select2').select2();
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        flatpickr("#journey-date", {
            altInput: true,       // Shows the "pretty" date to user
            altFormat: "d M Y",   // Format shown: 04 Jan 2026
            dateFormat: "Y-m-d",  // Format sent to Django: 2026-01-04
            minDate: "today",
            disableMobile: "true",
            animate: true,
            nextArrow: '<svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"></path></svg>',
            prevArrow: '<svg viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z"></path></svg>'
        });
    });
</script>

<script>
    //for search bar location
    document.addEventListener('DOMContentLoaded', function() {
        // 1. Fetch the data from your Django backend
        fetch("{% url 'get_search_locations' %}")
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    const locations = data.data;
                    const dataList = document.getElementById('location-list');
                    
                    // 2. Create options for the datalist
                    locations.forEach(loc => {
                        const option = document.createElement('option');
                        option.value = loc.name; // What user sees
                        // Optional: You can add the code in text like "Dhaka (DHK)"
                        // option.label = loc.code; 
                        dataList.appendChild(option);
                    });
                }
            })
            .catch(error => console.error('Error fetching locations:', error));
    });
</script>

<script>
    $(document).ready(function() {
        // Initialize "from" Select2
        $('#search-from').select2({
            width: '100%',
            placeholder: 'Select Origin'
        });

        // Initialize "to" Select2 with AJAX (will be populated dynamically)
        $('#search-to').select2({
            width: '100%',
            placeholder: 'Select Destination',
            ajax: {
                url: '{% url "get_available_destinations" %}',  // Django URL name for the view
                dataType: 'json',
                delay: 250,
                data: function(params) {
                    return {
                        from_id: $('#search-from').val()  // Send selected "from" ID
                    };
                },
                processResults: function(data) {
                    return {
                        results: data.results
                    };
                },
                cache: true
            }
        });

        // Enable "to" select when "from" is selected
        $('#search-from').on('change', function() {
            const fromValue = $(this).val();
            if (fromValue) {
                $('#search-to').prop('disabled', false).val(null).trigger('change');
            } else {
                $('#search-to').prop('disabled', true).val(null).trigger('change');
            }
        });
    });
</script>
{% endblock custom_js %}